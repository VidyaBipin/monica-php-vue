jobs:
- job: build
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - bash: |
      sudo update-alternatives --set php /usr/bin/php$(phpVersion)
      sudo update-alternatives --set phar /usr/bin/phar$(phpVersion)
      sudo update-alternatives --set phpdbg /usr/bin/phpdbg$(phpVersion)
      sudo update-alternatives --set php-cgi /usr/bin/php-cgi$(phpVersion)
      sudo update-alternatives --set phar.phar /usr/bin/phar.phar$(phpVersion)
      php -version
    displayName: 'Use PHP version $(phpVersion)'

  - template: prepare-environment-step.yml

  - bash: |
      sudo composer self-update
      yarn global add greenkeeper-lockfile@1
    displayName: 'Prepare environment'

  ## COMPOSER
  - bash: composer install --no-interaction --no-suggest --ignore-platform-reqs
    displayName: 'composer install'

  ## NODE.JS
  - bash: yarn inst
    displayName: 'yarn install'

  # Update js and css assets eventually
  - bash: yarn lint
    displayName: 'Check js and vue lint'
  - bash: bashs/ci/update-assets.sh
    displayName: 'Update assets'
